const _0x38f5b9=_0x5f0e;(function(_0x38d57c,_0x6e41bb){const _0x3c8bec=_0x5f0e,_0x58688f=_0x38d57c();while(!![]){try{const _0x497a6b=-parseInt(_0x3c8bec(0x104))/0x1*(parseInt(_0x3c8bec(0x129))/0x2)+-parseInt(_0x3c8bec(0x119))/0x3+-parseInt(_0x3c8bec(0xf4))/0x4+-parseInt(_0x3c8bec(0x146))/0x5*(parseInt(_0x3c8bec(0x135))/0x6)+parseInt(_0x3c8bec(0x136))/0x7*(parseInt(_0x3c8bec(0x118))/0x8)+-parseInt(_0x3c8bec(0x124))/0x9+-parseInt(_0x3c8bec(0x134))/0xa*(-parseInt(_0x3c8bec(0x122))/0xb);if(_0x497a6b===_0x6e41bb)break;else _0x58688f['push'](_0x58688f['shift']());}catch(_0xf9629e){_0x58688f['push'](_0x58688f['shift']());}}}(_0x1204,0x76884));const express=require(_0x38f5b9(0x13d)),dgram=require('dgram'),http=require(_0x38f5b9(0x147)),{PassThrough}=require('stream'),{spawn}=require(_0x38f5b9(0x113)),ChannelData=require(_0x38f5b9(0x11f)),v8=require('v8');function _0x1204(){const _0x42807b=['Uncaught\x20Exception:','Process\x20exited\x20with\x20code\x20','\x20--->\x20','---------------------------------','log','1MHVzlE','floor','sudo','inherit','stack','send','client\x20connected','\x20and\x20dst\x20port\x20','\x20is\x20NOT\x20assigned\x20to\x20','used_heap_size','unhandledRejection','push','forEach','close','includes','child_process','error','reason:','name','use','136KQnNJE','663912SgqyYS','Heap\x20Size\x20Limit:','/home','all','write','/usr/bin/tcpdump','./channels.json','PORT','ip\x20addr\x20show\x20dev\x20','1001QkMlXe','Bytes','8529867FpnRgM','address','data','Unhandled\x20Rejection\x20at:','/16','246154qejOze','Sender\x20IP:','No\x20sender\x20IP\x20found.','port','kill','splice','video/MP2T','\x20-->\x20','0.0.0.0','cleint\x20close\x20for\x20','Restart\x20triggered:\x20','147270neorhc','198ePCiWl','390684Yfmlze','--->','status','IP\x20address\x20added\x20successfully.','.ts','indexOf','stderr','express','Process\x20terminated','Error\x20running\x20command:\x20','get','-->\x20IP\x20address\x20added\x20successfully.','server\x20is\x20listinign\x20-\x20','Packet\x20','\x0a---\x20Formatted\x20Heap\x20Statistics\x20---','server\x20is\x20listining\x20-\x20','9985Xbygkd','http','message','enp86s0','udp\x20and\x20dst\x20host\x20','getHeapStatistics','SIGTERM','toFixed','SIGINT','env','Something\x20broke!','udp4','\x20|\x20grep\x20\x27','-->\x20Process\x20exited\x20with\x20code\x20','channel.ipaddress','senderIp','stdout','addMembership','1781632gkwqDj','exit','total_available_size','stderr:\x20','bind','multicastAddress','SIGTERM\x20received,\x20shutting\x20down\x20gracefully','dev','uncaughtException','Memory\x20usage:\x20','toString'];_0x1204=function(){return _0x42807b;};return _0x1204();}process['on'](_0x38f5b9(0xfc),_0x5b426f=>{const _0x246e11=_0x38f5b9;console[_0x246e11(0x114)](_0x246e11(0xff),_0x5b426f),process[_0x246e11(0xf5)](0x1);}),process['on'](_0x38f5b9(0x10e),(_0x3a158b,_0x4fb978)=>{const _0x1bc565=_0x38f5b9;console['error'](_0x1bc565(0x127),_0x4fb978,_0x1bc565(0x115),_0x3a158b),process['exit'](0x1);});function restartOnCondition(_0x301e31,_0x43e1c5){const _0x4c91d1=_0x38f5b9;_0x301e31&&(console[_0x4c91d1(0x103)](_0x4c91d1(0x133)+_0x43e1c5),process[_0x4c91d1(0xf5)](0x1));}function _0x5f0e(_0x39de45,_0x23927c){const _0x12046a=_0x1204();return _0x5f0e=function(_0x5f0e8a,_0x589752){_0x5f0e8a=_0x5f0e8a-0xe4;let _0x4408ff=_0x12046a[_0x5f0e8a];return _0x4408ff;},_0x5f0e(_0x39de45,_0x23927c);}const app=express();app[_0x38f5b9(0x117)]((_0x4ee52f,_0x2956a1,_0x17d576,_0x237aa3)=>{const _0x16f998=_0x38f5b9;console[_0x16f998(0x114)]('Express\x20Error:',_0x4ee52f[_0x16f998(0x108)]),_0x17d576[_0x16f998(0x138)](0x1f4)[_0x16f998(0x109)](_0x16f998(0xec)),_0x4ee52f['critical']&&(console[_0x16f998(0x103)]('Critical\x20error\x20detected,\x20restarting\x20server...'),process[_0x16f998(0xf5)](0x1));}),process['on'](_0x38f5b9(0xe8),()=>{const _0x54c1f6=_0x38f5b9;console[_0x54c1f6(0x103)](_0x54c1f6(0xfa)),server['close'](()=>{const _0x4438df=_0x54c1f6;console[_0x4438df(0x103)](_0x4438df(0x13e));});});function formatBytes(_0x22716a,_0x3c0eca=0x2){const _0x2d6f8c=_0x38f5b9;if(_0x22716a===0x0)return'0\x20Bytes';const _0x4b2ad9=0x400,_0x1ded17=_0x3c0eca<0x0?0x0:_0x3c0eca,_0x5d3ab2=[_0x2d6f8c(0x123),'KB','MB','GB','TB'],_0x1d3bee=Math[_0x2d6f8c(0x105)](Math[_0x2d6f8c(0x103)](_0x22716a)/Math['log'](_0x4b2ad9));return parseFloat((_0x22716a/Math['pow'](_0x4b2ad9,_0x1d3bee))[_0x2d6f8c(0xe9)](_0x1ded17))+'\x20'+_0x5d3ab2[_0x1d3bee];}const interfaceName=_0x38f5b9(0xe5),checkIp=async _0x3dc714=>{return new Promise((_0x48ee36,_0x4669c4)=>{const _0x9421e8=_0x5f0e,_0x11acd0=spawn('sh',['-c',_0x9421e8(0x121)+interfaceName+_0x9421e8(0xee)+_0x3dc714+'\x27']);let _0x4e4155='';_0x11acd0[_0x9421e8(0xf2)]['on']('data',_0xd2eebf=>{const _0x168a66=_0x9421e8;_0x4e4155+=_0xd2eebf[_0x168a66(0xfe)]();}),_0x11acd0[_0x9421e8(0x13c)]['on'](_0x9421e8(0x126),_0x4b8d98=>{const _0x3d9c6e=_0x9421e8;console[_0x3d9c6e(0x114)](_0x3d9c6e(0xf7)+_0x4b8d98),_0x4669c4('checkIp\x20error\x20:\x20'+_0x4b8d98);}),_0x11acd0['on']('close',_0xe55eac=>{const _0x4777b5=_0x9421e8;_0x4e4155[_0x4777b5(0x112)](_0x3dc714)?(console['log'](_0x3dc714+'\x20is\x20assigned\x20to\x20'+interfaceName),_0x48ee36(!![])):(console['log'](_0x3dc714+_0x4777b5(0x10c)+interfaceName),_0x48ee36(![]));});});},CreateIp=async _0x230daf=>{return new Promise((_0x5bd38c,_0x8b4d3f)=>{const _0x41836d=_0x5f0e,_0x4f52dc=_0x41836d(0x106),_0x39e1fd=['ip','addr','add',_0x230daf+_0x41836d(0x128),_0x41836d(0xfb),interfaceName],_0x23678c=spawn(_0x4f52dc,_0x39e1fd,{'stdio':_0x41836d(0x107)});_0x23678c['on'](_0x41836d(0x114),_0x5dab67=>{const _0x401e23=_0x41836d;console[_0x401e23(0x114)](_0x401e23(0x13f)+_0x5dab67['message']),_0x8b4d3f(_0x401e23(0x13f)+_0x5dab67['message']);}),_0x23678c['on'](_0x41836d(0xf5),_0x358a64=>{const _0x602598=_0x41836d;_0x358a64===0x0?(console[_0x602598(0x103)](_0x230daf,_0x602598(0x141)),_0x5bd38c(_0x602598(0x139))):(console[_0x602598(0x114)](_0x230daf,_0x602598(0xef)+_0x358a64),_0x8b4d3f(_0x602598(0x100)+_0x358a64));});});},PORT=process[_0x38f5b9(0xeb)][_0x38f5b9(0x120)]||0xfa1,networkId='10.85.0.',startHostId=0xa,restart_threshold=0x64,channels=ChannelData,senderIpCleintStreamMap={},clients={},captureSenderIp=_0x39def3=>{const _0x5ec6d3=_0x38f5b9,_0xed316f=_0x39def3['match'](/\b(\d{1,3}(?:\.\d{1,3}){3}\.\d+)\b/);if(_0xed316f){const _0x283af0=_0xed316f[0x1];return console[_0x5ec6d3(0x103)](_0x5ec6d3(0x12a),_0x283af0),_0x283af0;}else console['log'](_0x5ec6d3(0x12b));return null;},tcpdumpPath=_0x38f5b9(0x11e),startServer=()=>{const _0x11ad3a=_0x38f5b9,_0x4a9616=dgram['createSocket']({'type':_0x11ad3a(0xed),'reuseAddr':!![],'reusePort':!![]});_0x4a9616[_0x11ad3a(0xf8)](0x1389,()=>{channels['forEach'](_0x32ec94=>{const _0x6734a7=_0x5f0e;_0x4a9616[_0x6734a7(0xf3)](_0x32ec94[_0x6734a7(0xf9)]),console['log'](_0x4a9616[_0x6734a7(0x125)]());});}),_0x4a9616['on'](_0x11ad3a(0xe4),(_0x43f8b3,_0x3cb597)=>{const _0x4842ac=_0x11ad3a;clients[_0x3cb597[_0x4842ac(0x125)]+'.'+_0x3cb597[_0x4842ac(0x12c)]]?.['forEach'](({res:_0xa2e7f7})=>{const _0x40ce38=_0x4842ac;_0xa2e7f7?.[_0x40ce38(0x11d)](_0x43f8b3);});}),setInterval(()=>{const _0x11aeb7=_0x11ad3a,_0xfe0bcb=v8[_0x11aeb7(0xe7)]();console[_0x11aeb7(0x103)](_0x11aeb7(0x144)),console[_0x11aeb7(0x103)]('Total\x20Heap\x20Size:',formatBytes(_0xfe0bcb[_0x11aeb7(0xf6)])),console['log']('Used\x20Heap\x20Size:',formatBytes(_0xfe0bcb[_0x11aeb7(0x10d)])),console[_0x11aeb7(0x103)](_0x11aeb7(0x11a),formatBytes(_0xfe0bcb['heap_size_limit'])),console[_0x11aeb7(0x103)](_0x11aeb7(0x102));const _0x17b9e8=_0xfe0bcb[_0x11aeb7(0x10d)]/0x400/0x400;restartOnCondition(_0x17b9e8>restart_threshold,_0x11aeb7(0xfd)+_0x17b9e8[_0x11aeb7(0xe9)](0x2)+'MB');},0x2710),channels[_0x11ad3a(0x110)]((_0xc5e899,_0x44687c)=>{const _0x4567b8=_0x11ad3a,_0x539e44=_0x4567b8(0xe6)+_0xc5e899[_0x4567b8(0xf9)]+_0x4567b8(0x10b)+_0xc5e899['port'],_0x163338=['-i',_0x4567b8(0xe5),_0x539e44,'-n','-c','1'],_0x61ddfb=spawn(_0x4567b8(0x106),[tcpdumpPath,..._0x163338]);_0x61ddfb[_0x4567b8(0xf2)]['on'](_0x4567b8(0x126),_0x163dc1=>{const _0x2f1265=_0x4567b8,_0x39d020=_0x163dc1[_0x2f1265(0xfe)]();console[_0x2f1265(0x103)](_0x2f1265(0x143)+(_0x44687c+0x1)+':\x0a'+_0x39d020);const _0x480083=captureSenderIp(_0x39d020);_0x480083&&!channels[_0x44687c][_0x2f1265(0xf1)]&&(channels[_0x44687c][_0x2f1265(0xf1)]=_0x480083,clients[_0x480083]=[]),_0x61ddfb[_0x2f1265(0x12d)](_0x2f1265(0xea));}),_0x61ddfb['stderr']['on'](_0x4567b8(0x126),_0x7e1b2f=>{}),_0x61ddfb['on'](_0x4567b8(0x111),_0x258894=>{});let _0x6cdae7=0x0;app[_0x4567b8(0x140)]('/stream'+(_0x44687c+0x1)+_0x4567b8(0x13a),(_0x36abf2,_0x2f6f34)=>{const _0x25572d=_0x4567b8;_0x2f6f34['setHeader']('Content-Type',_0x25572d(0x12f)),console['log'](_0x25572d(0x10a),_0xc5e899[_0x25572d(0x116)]);const _0x2e4345={'res':_0x2f6f34,'id':_0x6cdae7};clients[_0xc5e899[_0x25572d(0xf1)]]?.[_0x25572d(0x10f)](_0x2e4345),_0x6cdae7++,_0x36abf2['on']('close',()=>{const _0x52e503=_0x25572d;console[_0x52e503(0x103)](_0x52e503(0x132),_0x2e4345['id']),_0x6cdae7--;const _0x5e4f9b=clients[_0xc5e899[_0x52e503(0xf1)]]?.[_0x52e503(0x13b)](_0x2e4345);console[_0x52e503(0x103)](_0x5e4f9b);if(_0x5e4f9b!==-0x1)clients[_0xc5e899[_0x52e503(0xf1)]][_0x52e503(0x12e)](_0x5e4f9b,0x1);});}),app['get'](_0x4567b8(0x11b)+(_0x44687c+0x1),(_0x4b9984,_0x45ee19)=>{const _0x38763d=_0x4567b8;_0x45ee19['send'](_0x38763d(0x142)+_0xc5e899['name']+_0x38763d(0x130)+_0xc5e899['multicastAddress']+'\x20--->\x20http://10.0.80.2:'+PORT+'/stream'+(_0x44687c+0x1)+_0x38763d(0x13a));});}),http['createServer'](app)['listen'](PORT,_0x11ad3a(0x131),()=>{const _0xff0d3a=_0x11ad3a;console['log'](_0xff0d3a(0x145),_0xff0d3a(0x11c),_0xff0d3a(0x137),'http://'+_0xff0d3a(0xf0)+':'+PORT);});},pushChannel=async(_0x51f4b1,_0x122449)=>{const _0x243676=_0x38f5b9,_0x324c89=''+networkId+(startHostId+_0x122449);try{const _0x18a2f8=await checkIp(_0x324c89);if(!_0x18a2f8)return await CreateIp(_0x324c89),_0x324c89;return channels[_0x122449]={..._0x51f4b1,'ipaddress':_0x324c89,'senderIp':null,'clientStream':new PassThrough()},_0x324c89;}catch(_0x27fc62){console[_0x243676(0x103)](_0x324c89,_0x243676(0x101),_0x27fc62);throw new Error(_0x27fc62);}};startServer();